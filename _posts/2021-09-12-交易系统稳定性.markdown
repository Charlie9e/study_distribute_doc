---
layout: post
title:  "交易系统稳定性"
date:   2021-09-12 10:51:01 +0800
categories:  trade
---
## 为什么要做稳定性？
- 交易系统属于关键链路，不可用直接影响业务
- 交易系统链路长、依赖多，容易受下游方影响

## 目标&方案
#### 可控性
- 定义
风险可控  

- 目标&方案
1. 业务需求评估准确 
2. 开发流程规范  
		- 分支管理
		- 代码规范
		- 设计方案
		- Code Review
3. 测试完备  
		- 测试用例
		- 边界测试
4. 上线流程规范
		- 上线check list
5. 业务处理准确  
		- 幂等
		- 核验系统
		- 容灾演练
6. 系统配置合理  
		- 全链路压测
7. 中间件配置合理
		- DB
		- Redis
		- MQ
8. 下游承载能力健康  
		- 全链路压测

#### 可观测
- 定义
打点/监控/告警完善  

- 目标&方案
1. 业务可观测  
		- QPS
		- RT
		- 异常
		- 重要业务操作
2. 单机可观测  
		- QPS
		- RT
		- 异常
		- JVM
		- CPU
		- 内存
		- 宿主机
3. 依赖可观测  
		- QPS
		- RT
		- 异常  
4. 中间件可观测  
		- QPS
		- RT
		- 异常
		- 内存
		- 堆积

#### 可保护
- 定义
线上异常预案完善  

- 目标&方案
1. 发布异常预案  
		- 灰度发布
		- 功能灰度
		- 发布回滚
		- 功能回滚
2. 业务异常预案  
		- 功能降级
3. 单节点异常预案  
		- 自动关闭
		- 可手动关闭
		- 可手动摘除  
4. 依赖异常预案  
		- 超时限制
		- 重试
		- 熔断
		- 隔离
		- 弱依赖降级
		- 强依赖降级
5. 中间件异常预案  

## 治理
#### 强弱依赖治理
1. 梳理关键链路  
2. 梳理依赖强弱以及方案  
	- 强弱依赖梳理  
	- 产品确认  
	- 强弱依赖改造  
	- 超时配置  
3. 新增依赖组内推进  
	- 测试阶段新增依赖提醒  
	- 超时配置不合理提醒  
4. 降级方案定期演练

#### 流量对比平台
1. 明确对比方案  
	- 写流量录制  
	- 根据业务录制request/response  
2. 流量对比组内推进

#### DB治理
1. 设计  
	- 容量预估  
	- 库表结构  
	- 索引设计  
	- 字段类型  
	- 分库分表  
2. 编码  
	- 压测覆盖  
	- 链接池配置  
	- 索引命中  
	- 死锁  
3. 运行  
	- SQL性能  
	- 读写比和压力  
	- 慢查询  
	- 主从延迟  
4. 优化  
	- 慢查询  
	- 大事务  
	- 大表  
	- 库容评估  
